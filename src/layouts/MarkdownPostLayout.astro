---
import BaseLayout from "./BaseLayout.astro";
import ArticleHeader from "../components/ArticleHeader.astro";

const { frontmatter } = Astro.props;
---

<BaseLayout pageTitle={frontmatter.title}>
    <!-- 文章头部信息 -->
    <ArticleHeader 
        title={frontmatter.title}
        description={frontmatter.description}
        author={frontmatter.author}
        pubDate={frontmatter.pubDate}
        tags={frontmatter.tags}
        image={frontmatter.image}
    />

    <div class="flex gap-8">
        <!-- 主内容 -->
        <article class="prose prose-slate dark:prose-invert max-w-none flex-1">
            <slot />
        </article>

        <!-- 右侧目录 -->
        <aside class="hidden lg:block w-64 shrink-0">
            <div class="sticky top-24">
                <h2 class="text-sm font-semibold mb-3 light:text-black dark:text-amber-50">目录</h2>
                <nav id="toc" class="space-y-1 text-sm light:text-black dark:text-amber-100"></nav>
            </div>
        </aside>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const toc = document.getElementById("toc");
            if (!toc) return;

            // 获取所有标题（h1-h6）
            const headings = document.querySelectorAll(
                "article h1, article h2, article h3, article h4, article h5, article h6",
            );

            if (headings.length === 0) return;

            // 找到最小的标题级别
            const levels = Array.from(headings).map(h => parseInt(h.tagName.charAt(1)));
            const minLevel = Math.min(...levels);

            // 创建目录列表
            let currentLevel = minLevel;
            let currentList = toc;

            headings.forEach((h, index) => {
                const level = parseInt(h.tagName.charAt(1));
                const id = `heading-${index}`;
                h.id = id;

                const li = document.createElement("li");
                const a = document.createElement("a");
                a.href = `#${id}`;
                a.textContent = h.textContent;
                a.className = `block hover:underline light:hover:text-gray-600 dark:hover:text-amber-200 transition-colors ${
                    level === minLevel ? "font-medium" : level === minLevel + 1 ? "ml-4 text-slate-600 dark:text-amber-100" : "ml-8 text-slate-500 dark:text-amber-100"
                }`;
                li.appendChild(a);
                li.style.listStyle = "none";

                currentList.appendChild(li);
                currentLevel = level;
            });
        });
    </script>
</BaseLayout>
